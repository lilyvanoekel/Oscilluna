<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Draw Shape to Waveform</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
      let scene, camera, renderer;
      let isDrawing = false;
      let points = [];
      let line, waveformLine;

      init();
      animate();

      function init() {
        scene = new THREE.Scene();
        camera = new THREE.OrthographicCamera(
          window.innerWidth / -2,
          window.innerWidth / 2,
          window.innerHeight / 2,
          window.innerHeight / -2,
          1,
          1000
        );
        camera.position.z = 2;

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        window.addEventListener("mousedown", onMouseDown, false);
        window.addEventListener("mouseup", onMouseUp, false);
        window.addEventListener("mousemove", onMouseMove, false);
        window.addEventListener("resize", onWindowResize, false);
      }

      function onMouseDown(event) {
        isDrawing = true;
        points = [];
        if (waveformLine) {
          scene.remove(waveformLine);
          waveformLine.geometry.dispose();
        }
      }

      function onMouseUp(event) {
        isDrawing = false;
        if (line) {
          scene.remove(line);
          line.geometry.dispose();
        }
        if (points.length > 2) {
          const waveform = generateWaveform(points);
          displayWaveform(waveform);
        }
      }

      function onMouseMove(event) {
        if (isDrawing) {
          const mouseX = event.clientX - window.innerWidth / 2;
          const mouseY = window.innerHeight / 2 - event.clientY;
          points.push(new THREE.Vector3(mouseX, mouseY, 0));

          if (line) {
            scene.remove(line);
            line.geometry.dispose();
          }

          const geometry = new THREE.BufferGeometry().setFromPoints(points);
          const material = new THREE.LineBasicMaterial({
            color: 0xff00ff,
            linewidth: 50,
            transparent: true,
            opacity: 0.9,
            blending: THREE.AdditiveBlending,
          });

          line = new THREE.Line(geometry, material);
          scene.add(line);
        }
      }

      function generateWaveform(points) {
        const waveform = [];
        const numPoints = points.length;
        for (let i = 0; i < numPoints; i++) {
          waveform.push(points[i].y / window.innerHeight);
        }
        return waveform;
      }

      function displayWaveform(waveform) {
        const waveformGeometry = new THREE.BufferGeometry();
        const waveformVertices = [];
        const numPoints = waveform.length;

        for (let i = 0; i < numPoints; i++) {
          const x = (i / numPoints) * window.innerWidth - window.innerWidth / 2;
          const y = waveform[i] * window.innerHeight;
          waveformVertices.push(x, y, 0);
        }

        waveformGeometry.setAttribute(
          "position",
          new THREE.Float32BufferAttribute(waveformVertices, 3)
        );
        const waveformMaterial = new THREE.LineBasicMaterial({
          color: 0x00ffff,
          linewidth: 3,
          transparent: true,
          opacity: 0.8,
          blending: THREE.AdditiveBlending,
        });
        waveformLine = new THREE.Line(waveformGeometry, waveformMaterial);
        scene.add(waveformLine);
      }

      function onWindowResize() {
        camera.left = window.innerWidth / -2;
        camera.right = window.innerWidth / 2;
        camera.top = window.innerHeight / 2;
        camera.bottom = window.innerHeight / -2;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
